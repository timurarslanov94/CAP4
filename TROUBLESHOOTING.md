# Troubleshooting Guide

## Problem: "could not find UA for [number]"

### –ü—Ä–∏—á–∏–Ω–∞
Baresip –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä –∫–æ–º–∞–Ω–¥—ã `dial` –∫–∞–∫ UA –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä, –∞ –Ω–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞.

### –†–µ—à–µ–Ω–∏–µ
–ú–µ—Ç–æ–¥ `dial()` —Ç–µ–ø–µ—Ä—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–±—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–æ—Ä–º–∞—Ç–æ–≤:

1. **SIP URI**: `sip:79123456789@sip.exolve.ru` - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
2. **–ü—Ä–æ—Å—Ç–æ–π –Ω–æ–º–µ—Ä**: `79123456789` - –µ—Å–ª–∏ –ø–µ—Ä–≤—ã–π –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç  
3. **–° –∏–Ω–¥–µ–∫—Å–æ–º UA**: `0 sip:79123456789@sip.exolve.ru` - –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏–π

### –ü—Ä–æ–≤–µ—Ä–∫–∞
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç:
```bash
python test_baresip_dial.py 79123456789
```

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é SIP:**
```bash
# –í –∫–æ–Ω—Å–æ–ª–∏ Baresip –Ω–∞–∂–º–∏—Ç–µ 'r' –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π
```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–ø–∏—Å–æ–∫ UA:**
```bash
# –í –∫–æ–Ω—Å–æ–ª–∏ Baresip –Ω–∞–∂–º–∏—Ç–µ 'u' –¥–ª—è —Å–ø–∏—Å–∫–∞ User Agents
```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –≤ accounts —Ñ–∞–π–ª–µ:**
```bash
cat config/baresip/accounts
```
–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
<sip:user@domain>;auth_user=user;auth_pass=pass;outbound="sip:server"
```

## Problem: –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ GET –∑–∞–ø—Ä–æ—Å—ã –∫ /api/calls

### –ü—Ä–∏—á–∏–Ω–∞
SIPCallMonitor —Å–æ–∑–¥–∞–≤–∞–ª HTTP polling loop, –æ–ø—Ä–∞—à–∏–≤–∞—è API –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã.

### –†–µ—à–µ–Ω–∏–µ
‚úÖ –û—Ç–∫–ª—é—á–µ–Ω SIPCallMonitor –≤ `src/api/app.py`
‚úÖ –°–æ–±—ã—Ç–∏—è –º–æ–Ω–∏—Ç–æ—Ä—è—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ Baresip TCP

### –ü—Ä–æ–≤–µ—Ä–∫–∞
–í –ª–æ–≥–∞—Ö API –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö:
```
INFO: 127.0.0.1:xxxxx - "GET /api/calls HTTP/1.1" 200 OK
```

## Problem: WebSocket –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –ø—Ä–∏ –∞–≤—Ç–æ–æ—Ç–≤–µ—Ç—á–∏–∫–µ

### –ü—Ä–∏—á–∏–Ω–∞
–°–∏—Å—Ç–µ–º–∞ –Ω–µ —Ä–∞–∑–ª–∏—á–∞–ª–∞ SIP 183 (–æ–ø–µ—Ä–∞—Ç–æ—Ä) –∏ SIP 200 (—Ä–µ–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç).

### –†–µ—à–µ–Ω–∏–µ
‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ SIP —Å–æ–±—ã—Ç–∏–π –≤ `CallService._monitor_call_events()`
‚úÖ WebSocket –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ `CALL_ESTABLISHED` (SIP 200)
‚úÖ –ü—Ä–∏ `CALL_PROGRESS` (SIP 183) WebSocket –ù–ï –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è

### –ü—Ä–æ–≤–µ—Ä–∫–∞
–ü—Ä–∏ –∑–≤–æ–Ω–∫–µ –Ω–∞ –∞–≤—Ç–æ–æ—Ç–≤–µ—Ç—á–∏–∫ –≤ –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
üì¢ CALL_PROGRESS (SIP 183) detected
‚ùå NOT connecting WebSocket (saving ElevenLabs credits)
```

## Common Baresip Commands

### –ß–µ—Ä–µ–∑ TCP –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (netstring format):
```python
# Dial
{"command": "dial", "params": "sip:number@domain"}

# Hangup
{"command": "hangup"}

# Answer incoming call
{"command": "accept"}

# Get registration info
{"command": "reginfo"}
```

### –í –∫–æ–Ω—Å–æ–ª–∏ Baresip:
- `d` - dial (–Ω–∞–±—Ä–∞—Ç—å –Ω–æ–º–µ—Ä)
- `h` - hangup (–ø–æ–≤–µ—Å–∏—Ç—å —Ç—Ä—É–±–∫—É)
- `a` - answer (–æ—Ç–≤–µ—Ç–∏—Ç—å)
- `r` - registration info
- `u` - user agents list
- `?` - help